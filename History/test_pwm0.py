import os
import time

PWM_DEVICE = "/sys/class/pwm/pwmchip0/pwm0"
PWM_ENABLE = os.path.join(PWM_DEVICE, "enable")
PWM_PERIOD = os.path.join(PWM_DEVICE, "period")
PWM_DUTY_CYCLE = os.path.join(PWM_DEVICE, "duty_cycle")
PWM_POLARITY = os.path.join(PWM_DEVICE, "polarity") # ??? ???????? ???????, ???? ?????

def setup_pwm(period_ns):
    """??????????? PWM ? ???????? ????????."""
    with open(PWM_ENABLE, "w") as f:
        f.write("1")  # ???????? PWM
    with open(PWM_PERIOD, "w") as f:
        f.write(str(period_ns))  # ?????? ?????? ? ????????????
    with open(PWM_POLARITY, "w") as f:
        f.write("0") # ?????????? ?????????? (????? ???????? ?? "1" ??? ????????)


def generate_pulses(duty_cycle_ns, num_pulses):
    """Генерируем заданное количество импульсов."""
    with open(PWM_DUTY_CYCLE, "w") as f:
        f.write(str(duty_cycle_ns))  # ?????? ???????????? ???????? ? ????????????

    for _ in range(num_pulses):
        time.sleep(duty_cycle_ns/1e9 + (int(period_ns)-int(duty_cycle_ns))/1e9) #???????? ????? ???????


def cleanup():
    """Выключили PWM."""
    with open(PWM_ENABLE, "w") as f:
        f.write("0")


period_ns = 20000000  # ?????? 20 ?? (50 ??)
duty_cycle_ns = 1000000 # ???????????? ???????? 1 ??

setup_pwm(period_ns)

generate_pulses(duty_cycle_ns, 10)  # 10 ?????????
print("????????????? 10 ?????????")

generate_pulses(duty_cycle_ns, 5)   # 5 ?????????
print("????????????? 5 ?????????")

cleanup()
print("PWM ????????")