# üìä –°–æ—Å—Ç–æ—è–Ω–∏–µ –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ BMI30 –∏ –¢—Ä–µ–±—É–µ–º—ã–µ –î–µ–π—Å—Ç–≤–∏—è

**–î–∞—Ç–∞**: 21 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å**: ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–µ–π—Å—Ç–≤–∏–µ  

---

## üîç –¢–µ–∫—É—â–µ–µ –°–æ—Å—Ç–æ—è–Ω–∏–µ

### –ß—Ç–æ –ò–º–µ–µ—Ç—Å—è

‚úÖ **–ù–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ (Linux)**:
- Python –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Å pyusb, PyQt5, numpy
- –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ GUI (`BMI30.200.py`)
- USB —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç (`usb_vendor/usb_stream.py`)
- –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ—à–∏–≤–∫–∞ (`firmware/BMI30.stm32h7.elf`)
- –í—Å—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –ø—Ä–∏–º–µ—Ä—ã
- Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å GitHub

‚úÖ **–§–∏–∑–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ**:
- –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ BMI30 –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ USB (VID:PID = 0xCAFE:0x4001)
- –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç—Å—è –û–°: `lsusb | grep cafe:4001`

‚ùå **–ü—Ä–æ–±–ª–µ–º–∞ —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º**:
- –ù–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ **CDC –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã IF#0 –∏ IF#1)
- –¢—Ä–µ–±—É–µ—Ç—Å—è **Vendor Bulk –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å IF#2 —Å endpoints 0x03/0x83)
- **GUI –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è** –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –Ω—É–∂–Ω—ã—Ö endpoints

### –î–µ—Ç–∞–ª—å–Ω–æ–µ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ

#### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (CDC):
```
Configuration 1:
  ‚îú‚îÄ Interface 0 (CDC Control)
  ‚îÇ  ‚îî‚îÄ EP 0x82 (Interrupt IN)
  ‚îÇ
  ‚îî‚îÄ Interface 1 (CDC Data)
     ‚îú‚îÄ EP 0x01 (Bulk OUT)
     ‚îî‚îÄ EP 0x81 (Bulk IN)
```

#### –¢—Ä–µ–±—É–µ–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (Vendor Bulk):
```
Configuration 1:
  ‚îú‚îÄ Interface 0 (CDC Control) - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
  ‚îú‚îÄ Interface 1 (CDC Data) - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
  ‚îÇ
  ‚îî‚îÄ Interface 2 (Vendor Bulk Stereo) ‚Üê –¢–†–ï–ë–£–ï–¢–°–Ø
     ‚îú‚îÄ EP 0x03 (Bulk OUT)
     ‚îî‚îÄ EP 0x83 (Bulk IN)
```

---

## üõ†Ô∏è –ß—Ç–æ –ù—É–∂–Ω–æ –°–¥–µ–ª–∞—Ç—å

### –í–∞—Ä–∏–∞–Ω—Ç 1Ô∏è‚É£: –ü–µ—Ä–µ–ø—Ä–æ—à–∏—Ç—å –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

–ü—Ä–æ—à–∏–≤–∫–∞ –Ω—É–∂–Ω–∞ **–Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Vendor Bulk (IF#2).

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**:
- ST-Link v2 –ø—Ä–æ–≥—Ä–∞–º–º–∞—Ç–æ—Ä (–ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫ RPi GPIO)
- OpenOCD (—É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: `/usr/bin/openocd`)
- –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ USB

**–°—Ö–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è ST-Link –∫ RPi GPIO**:
```
Raspberry Pi GPIO (–≤–∏–¥ —Å–≤–µ—Ä—Ö—É)
Pin 11 (GPIO 17) ‚îÄ‚îÄ‚Üí ST-Link SWDIO (Pin 4)
Pin 13 (GPIO 27) ‚îÄ‚îÄ‚Üí ST-Link SWDCLK (Pin 9)
Pin 9 –∏–ª–∏ 25 (GND) ‚îÄ‚îÄ‚Üí ST-Link GND (Pin 3)
```

**–ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ—à–∏–≤–∞–Ω–∏—è** (–∫–æ–≥–¥–∞ ST-Link –ø–æ–¥–∫–ª—é—á–µ–Ω):
```bash
cd /home/techaid/Documents
chmod +x flash_firmware.sh
./flash_firmware.sh
```

**–ò–ª–∏ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ OpenOCD**:
```bash
openocd -f /usr/share/openocd/scripts/interface/stlink.cfg \
        -f /usr/share/openocd/scripts/target/stm32h7x.cfg \
        -c "init" \
        -c "halt" \
        -c "stm32h7x mass_erase 0" \
        -c "program /home/techaid/Documents/firmware/BMI30.stm32h7.elf 0x08000000 verify" \
        -c "reset run" \
        -c "exit"
```

**–ü–æ—Å–ª–µ –ø—Ä–æ—à–∏–≤–∞–Ω–∏—è**:
1. –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—Å—è –≤ Vendor Bulk —Ä–µ–∂–∏–º–µ
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: `lsusb -d cafe:4001 -v` –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å IF#2 —Å EP 0x03/0x83
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å GUI: `python3 BMI30.200.py`

---

### –í–∞—Ä–∏–∞–Ω—Ç 2Ô∏è‚É£: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CDC –†–µ–∂–∏–º (–ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ê)

–ï—Å–ª–∏ –Ω–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–ø—Ä–æ—à–∏—Ç—å, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CDC —Ä–µ–∂–∏–º —á–µ—Ä–µ–∑ serial:

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π CDC —Å—Ç–µ–∫ (serial –ø–æ—Ä—Ç)
python3 /home/techaid/Documents/HostTools/rpi_cdc_client.py
```

**–ú–∏–Ω—É—Å—ã**:
- –ú–µ–¥–ª–µ–Ω–Ω–µ–µ (~200 FPS –≤–º–µ—Å—Ç–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö 300+)
- –¢—Ä–µ–±—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ GUI –¥–ª—è CDC
- –¢–µ–∫—É—â–∏–π GUI (`BMI30.200.py`) –Ω–µ —Å–æ–≤–º–µ—Å—Ç–∏–º —Å CDC

---

## üìã –ü–æ—à–∞–≥–æ–≤–∞—è –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ü—Ä–æ—à–∏–≤–∞–Ω–∏—è

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
```bash
# –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ OpenOCD —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
openocd --version

# –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—Ä–æ—à–∏–≤–∫–∞ –Ω–∞ –º–µ—Å—Ç–µ
ls -lh /home/techaid/Documents/firmware/BMI30.stm32h7.elf
```

### –®–∞–≥ 2: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ ST-Link
```
1. –û—Ç–∫–ª—é—á–∏—Ç—å USB –∫–∞–±–µ–ª—å –æ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ BMI30 (–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ –º–µ—Å—Ç–µ!)
2. –ü–æ–¥–∫–ª—é—á–∏—Ç—å ST-Link –∫ RPi GPIO:
   - Pin 11 (GPIO 17) ‚Üí ST-Link SWDIO
   - Pin 13 (GPIO 27) ‚Üí ST-Link SWDCLK
   - Pin 9/25 (GND) ‚Üí ST-Link GND
3. –ü–æ–¥–∫–ª—é—á–∏—Ç—å ST-Link –∫ –∫–æ–º–ø—å—é—Ç–µ—Ä—É —á–µ—Ä–µ–∑ USB
4. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ ST-Link –≤–∏–¥–µ–Ω: lsusb | grep -i stlink
```

### –®–∞–≥ 3: –ó–∞–ø—É—Å–∫ –ü—Ä–æ—à–∏–≤–∞–Ω–∏—è
```bash
cd /home/techaid/Documents

# –°–ø–æ—Å–æ–± A: –ß–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π)
chmod +x flash_firmware.sh
./flash_firmware.sh

# –°–ø–æ—Å–æ–± B: –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ OpenOCD
openocd -f /usr/share/openocd/scripts/interface/stlink.cfg \
        -f /usr/share/openocd/scripts/target/stm32h7x.cfg \
        -c "init" \
        -c "halt" \
        -c "stm32h7x mass_erase 0" \
        -c "program firmware/BMI30.stm32h7.elf 0x08000000 verify" \
        -c "reset run" \
        -c "exit"
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞
```bash
# –î–æ–∂–¥–∞—Ç—å—Å—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–æ–±—ã—á–Ω–æ 2-3 —Å–µ–∫)
sleep 3

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
lsusb -d cafe:4001 -v | grep -A 20 "Interface"

# –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
# Interface 2, Alternate setting 0 (or 1)
#   Endpoints:
#     EP 0x03 (Bulk OUT)
#     EP 0x83 (Bulk IN)
```

### –®–∞–≥ 5: –ó–∞–ø—É—Å–∫ GUI
```bash
cd /home/techaid/Documents
python3 BMI30.200.py
```

---

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –£—Å–ø–µ—Ö–∞

–ü–æ—Å–ª–µ –ø—Ä–æ—à–∏–≤–∞–Ω–∏—è GUI –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å:
```
‚úÖ Device found: 0xCAFE:0x4001
‚úÖ Interface 2 with EP 0x03/0x83 located
‚úÖ SET_INTERFACE alt=1 successful
‚úÖ alt1=1, out_armed=1 (STAT ready)
‚úÖ Two synchronized oscillograms (ADC0 green, ADC1 blue)
‚úÖ ~200 FPS frame rate
‚úÖ Sample index on X-axis
‚úÖ BUF=XXXX FREQ=200Hz in legend
```

---

## ‚ùì FAQ

### Q: –ß—Ç–æ –µ—Å–ª–∏ ST-Link –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω?
**A**: –ù—É–∂–Ω–æ –µ–≥–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫ RPi GPIO. –≠—Ç–æ —Ç–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–± –ø—Ä–æ—à–∏—Ç—å STM32H7. –ë–µ–∑ –Ω–µ–≥–æ –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ Vendor Bulk —Ä–µ–∂–∏–º.

### Q: –ú–æ–≥—É –ª–∏ —è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–∞—Ç–æ—Ä?
**A**: –î–∞, –ø–æ–¥–æ–π–¥—ë—Ç –ª—é–±–æ–π STM32H7 –ø—Ä–æ–≥—Ä–∞–º–º–∞—Ç–æ—Ä (J-Link, Segger, OpenSDA). –ù—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å OpenOCD.

### Q: –ß—Ç–æ –µ—Å–ª–∏ –ø—Ä–æ—à–∏–≤–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è?
**A**: –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
- ST-Link –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∏–Ω—ã)
- –ü–∏—Ç–∞–Ω–∏–µ –Ω–µ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å –∫ –ø—Ä–æ—à–∏–≤–∫–µ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: `openocd ... -c "init"` –¥–æ–ª–∂–µ–Ω –Ω–∞–π—Ç–∏ STM32H7

### Q: –ö–∞–∫ –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –Ω–∞ CDC?
**A**: –ù—É–∂–Ω–∞ CDC –≤–µ—Ä—Å–∏—è –ø—Ä–æ—à–∏–≤–∫–∏ (–æ–±—ã—á–Ω–æ –ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ). –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ—à–∏–≤–∞–Ω–∏–µ —Å CDC ELF —Ñ–∞–π–ª–æ–º.

### Q: –ü–æ—Ç–µ—Ä—è—é—Ç—Å—è –ª–∏ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ø—Ä–æ—à–∏–≤–∞–Ω–∏–∏?
**A**: –ù–µ—Ç, –ø—Ä–æ—à–∏–≤–∫–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤–æ flash –ø–∞–º—è—Ç–∏. –î–∞–Ω–Ω—ã–µ (–µ—Å–ª–∏ –µ—Å—Ç—å) –≤ SRAM —Å–æ—Ç—Ä—É—Ç—Å—è, –Ω–æ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ.

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏**:
   ```bash
   dmesg | tail -20  # –õ–æ–≥–∏ —è–¥—Ä–∞ Linux
   ```

2. **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ USB**:
   ```bash
   lsusb -d cafe:4001 -v
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞**:
   ```bash
   sudo udevadm control --reload-rules
   sudo udevadm trigger
   ```

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ GitHub**:
   ```bash
   cd /home/techaid/Documents
   git status
   git log --oneline | head -10
   ```

---

## üìù –§–∞–π–ª—ã –ü—Ä–æ–µ–∫—Ç–∞

```
/home/techaid/Documents/
‚îú‚îÄ‚îÄ BMI30.200.py                    # GUI (—Ç—Ä–µ–±—É–µ—Ç Vendor Bulk —Ä–µ–∂–∏–º–∞)
‚îú‚îÄ‚îÄ usb_vendor/
‚îÇ   ‚îî‚îÄ‚îÄ usb_stream.py              # USB —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
‚îú‚îÄ‚îÄ firmware/
‚îÇ   ‚îî‚îÄ‚îÄ BMI30.stm32h7.elf          # –ü—Ä–æ—à–∏–≤–∫–∞ (—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ—à–∏–≤–∞–Ω–∏–µ)
‚îú‚îÄ‚îÄ HostTools/
‚îÇ   ‚îú‚îÄ‚îÄ rpi_vendor_minimal.py       # –ü—Ä–∏–º–µ—Ä Vendor Bulk
‚îÇ   ‚îú‚îÄ‚îÄ rpi_cdc_client.py           # –ü—Ä–∏–º–µ—Ä CDC (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)
‚îÇ   ‚îî‚îÄ‚îÄ vendor_stream_read.py       # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–∞
‚îú‚îÄ‚îÄ flash_firmware.sh               # –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–æ—à–∏–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ DEVICE_STATUS.md                # –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ LAUNCH.md                       # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞
‚îî‚îÄ‚îÄ README.md                       # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
```

---

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –ü–æ–¥–∫–ª—é—á–∏—Ç—å ST-Link –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ—à–∏–≤–∞–Ω–∏–µ! üöÄ
