# BMI30 USB Oscilloscope ‚Äî –°–≤–æ–¥–∫–∞ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ò–∑–º–µ–Ω–µ–Ω–∏–π

## üéØ –¶–µ–ª—å –°–µ—Å—Å–∏–∏

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å **–∂–∏–≤—É—é –æ—Å—Ü–∏–ª–ª–æ–≥—Ä–∞–º–º—É** –¥–ª—è BMI30 Vendor Bulk —Å—Ç–µ—Ä–µ–æ –ø–æ—Ç–æ–∫–∞ —Å:
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º **–∏–Ω–¥–µ–∫—Å–æ–≤ —Å–µ–º–ø–ª–æ–≤** –Ω–∞ X-–æ—Å–∏ (–±–µ–∑ –≤—Ä–µ–º–µ–Ω–∏)
- –ü–æ–∫–∞–∑–æ–º **—Ä–∞–∑–º–µ—Ä–∞ –±—É—Ñ–µ—Ä–∞** –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ 1
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç—å—é –ø—Ä–∏–µ–º–∞** –¥–∞–Ω–Ω—ã—Ö (–¥–æ 200 FPS)
- **–ù–∞–¥—ë–∂–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–µ–π** A/B –ø–∞—Ä —Å—Ç–µ—Ä–µ–æ-–¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ USB

---

## ‚úÖ –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –ó–∞–¥–∞—á–∏

### 1. **GUI: X-–æ—Å—å = –ò–Ω–¥–µ–∫—Å—ã –°–µ–º–ø–ª–æ–≤**
- **–§–∞–π–ª**: `BMI30.200.py`
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
  - –ú–µ—Ç–æ–¥ `_apply_x_axis_mode()` —Ç–µ–ø–µ—Ä—å —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç X-–æ—Å—å –∫–∞–∫ —Ü–µ–ª—ã–µ –∏–Ω–¥–µ–∫—Å—ã (0, 1, 2, ...)
  - –ú–µ—Ç–∫–∞ –æ—Å–∏: `"samples"` –≤–º–µ—Å—Ç–æ `"time"`
  - –ù–∏–∫–∞–∫–æ–≥–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥—ã; —á–∏—Å—Ç—ã–µ –Ω–æ–º–µ—Ä–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –±—É—Ñ–µ—Ä–∞
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ –ì—Ä–∞—Ñ–∏–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å–µ–º–ø–ª—ã, –±–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫

### 2. **GUI: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ BUF –ø—Ä–∏ Start**
- **–§–∞–π–ª**: `BMI30.200.py` (–º–µ—Ç–æ–¥ `_activate_stream`)
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
  - –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º —Å—Ç–∞—Ä—Ç–µ –ø–æ—Ç–æ–∫–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç –ª–µ–≥–µ–Ω–¥—É:
    ```
    BUF=XXXX FREQ=200Hz
    ```
  - `XXXX` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ–º–ø–ª–æ–≤ –≤ –æ–¥–Ω–æ–º –±—É—Ñ–µ—Ä–µ (–æ–±—ã—á–Ω–æ 680 –¥–ª—è –ø—Ä–æ—Ñ–∏–ª—è 1)
  - `FREQ` ‚Äî —á–∞—Å—Ç–æ—Ç–∞ (200 –ì—Ü –∏–ª–∏ 300 –ì—Ü)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ –õ–µ–≥–µ–Ω–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞ –≤ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ –æ–∫–Ω–∞

### 3. **USB Transport: SET_INTERFACE –∫–∞–∫ –û—Å–Ω–æ–≤–Ω–æ–π Alt-Setter**
- **–§–∞–π–ª**: `usb_vendor/usb_stream.py` (–º–µ—Ç–æ–¥ `_ensure_alt`, —Å—Ç—Ä–æ–∫–∏ ~620‚Äì705)
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
  - –ü–µ—Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–∞ –æ—á–µ—Ä–µ–¥—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö —Å–ø–æ—Å–æ–±–æ–≤:
    1. **–ü–µ—Ä–≤—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π `set_interface_altsetting(2, 1)` (PyUSB API)
    2. **–í—Ç–æ—Ä–æ–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: Ctrl-transfer `SET_INTERFACE (0x0B/0x01, wIndex=2)`
    3. **–¢—Ä–µ—Ç–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: Vendor `SET_ALT (0x31/0x40 –∏–ª–∏ 0x31/0x41)`
  - –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è:
    - –í—ã–∑–æ–≤ `_wait_ready(0.2s)` –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è alt1/out_armed —Ñ–ª–∞–≥–æ–≤
    - –í—ã–∑–æ–≤ `_clear_halt_eps()` –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ HALT –Ω–∞ 0x03/0x83
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ firmware (SET_INTERFACE –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ vendor –º–µ—Ç–æ–¥–æ–≤)

### 4. **USB Transport: –£–ø—Ä–æ—â—ë–Ω–Ω—ã–π _wait_ready —Å CLEAR_HALT**
- **–§–∞–π–ª**: `usb_vendor/usb_stream.py` (–º–µ—Ç–æ–¥ `_wait_ready`, —Å—Ç—Ä–æ–∫–∏ ~364‚Äì394)
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
  - –£–¥–∞–ª–µ–Ω –≤–µ—Å—å –∫–æ–¥ toggle alt (—ç—Ç–æ —Ç–µ–ø–µ—Ä—å –¥–µ–ª–∞–µ—Ç `_ensure_alt`)
  - –ß–∏—Å—Ç–æ–µ **EP0 GET_STATUS polling**:
    - –ö–∞–∂–¥—ã–µ ~7 –º—Å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç STAT
    - –ò—â–µ—Ç —Ñ–ª–∞–≥–∏: `alt1 = (flags2 >> 15) & 1` –∏ `out_armed = (reserved2 >> 7) & 1`
    - –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –¥–æ –æ–±–æ–∏—Ö —Ñ–ª–∞–≥–æ–≤ = 1 –∏–ª–∏ timeout (200 –º—Å)
  - –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ–∂–∏–¥–∞–Ω–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç `_clear_halt_eps()`
  - **–ù–µ—Ç ZLP** (Zero Length Packet) ‚Äî firmware –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç out_armed –≤ 1
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ Handshake –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ STAT v1

### 5. **USB Transport: STAT v1 Parser –ò—Å–ø—Ä–∞–≤–ª–µ–Ω**
- **–§–∞–π–ª**: `BMI30.200.py` (–º–µ—Ç–æ–¥ `_diagnose_and_kick`, —Å—Ç—Ä–æ–∫–∏ ~792‚Äì815) –∏ `usb_vendor/usb_stream.py` (–º–µ—Ç–æ–¥ `_parse_stat_ready`, —Å—Ç—Ä–æ–∫–∏ ~350‚Äì363)
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
  - **Byte 50‚Äì52** (flags2): `alt1 = (flags2 >> 15) & 1`
  - **Byte 53** (reserved2): `out_armed = (reserved2 >> 7) & 1`
  - **–£–±—Ä–∞–Ω** –Ω–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ —á—Ç–µ–Ω–∏—è last_reset_reason (–±—ã–ª –∏–∑ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Å–º–µ—â–µ–Ω–∏—è)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ—á–Ω—ã–µ —Å–º–µ—â–µ–Ω–∏—è –∏–∑ STAT v1 —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏

### 6. **USB Transport: EIO –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ send_cmd**
- **–§–∞–π–ª**: `usb_vendor/usb_stream.py` (–º–µ—Ç–æ–¥ `send_cmd`, —Å—Ç—Ä–æ–∫–∏ ~710‚Äì745)
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
  - –ü—Ä–∏ –æ—à–∏–±–∫–µ —Å errno 5 (EIO) –∏–ª–∏ 32 (EPIPE):
    - –í—ã–∑—ã–≤–∞–µ—Ç `_get_status_ep0()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ STAT
    - –õ–æ–≥–∏—Ä—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è alt1/out_armed (–¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏)
    - –í—ã–∑—ã–≤–∞–µ—Ç `_clear_halt_eps()` –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ HALT
    - –í—ã–∑—ã–≤–∞–µ—Ç `_wait_ready(0.2s)` –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
    - **–ü–æ–≤—Ç–æ—Ä—è–µ—Ç** OUT –∫–æ–º–∞–Ω–¥—É (–º–∞–∫—Å–∏–º—É–º 3 –ø–æ–ø—ã—Ç–∫–∏)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ EIO –æ—à–∏–±–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

### 7. **EP0 GET_STATUS: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π Recipient Type**
- **–§–∞–π–ª**: `usb_vendor/usb_stream.py` (–º–µ—Ç–æ–¥ `_get_status_ep0`, —Å—Ç—Ä–æ–∫–∏ ~330‚Äì350)
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**:
  - bmRequestType = `0xC0` (Device recipient) –≤–º–µ—Å—Ç–æ `0xC1` (Interface recipient)
  - wIndex = `0` (–¥–ª—è Device —Å—Ç–∞—Ç—É—Å–∞)
  - –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∏—Ç—å STAT –¥–∞–∂–µ –µ—Å–ª–∏ Interface –Ω–µ –≤—ã–±—Ä–∞–Ω
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ GET_STATUS —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ª—é–±–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ (CONFIGURED, –¥–∞–∂–µ –ø—Ä–∏ alt=0)

---

## üìã STAT v1 –§–æ—Ä–º–∞—Ç (–û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω)

```
Byte Offset | –†–∞–∑–º–µ—Ä | –ü–æ–ª–µ              | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –ö–æ–¥–µ
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
0‚Äì4         | 4      | sig="STAT"        | –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏
4           | 1      | version=1         | STAT v1 format marker
48‚Äì50       | 2      | flags_runtime     | (reserved, bit2=hang_latched)
50‚Äì52       | 2      | flags2            | **alt1 = (flags2 >> 15) & 1**
52          | 1      | sending_ch        | 0=A, 1=B, 0xFF=idle
**53**      | **1**  | **reserved2**     | **out_armed = (reserved2 >> 7) & 1**
54‚Äì56       | 2      | pair_idx          | –ò–Ω–¥–µ–∫—Å —Ç–µ–∫—É—â–µ–π –ø–∞—Ä—ã
```

**–ö–ª—é—á–µ–≤—ã–µ —á–∏—Ç–∞–µ–º—ã–µ –ø–æ–ª—è**:
- `alt1`: –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–µ–Ω (alt=1)
- `out_armed`: —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≥–æ—Ç–æ–≤–æ –ø–æ–ª—É—á–∞—Ç—å OUT –∫–æ–º–∞–Ω–¥—ã
- `sending_ch`: –∫–∞–∫–æ–π –∫–∞–Ω–∞–ª (A/B) –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç
- `pair_idx`: –∏–Ω–¥–µ–∫—Å —Ç–µ–∫—É—â–µ–π –ø–∞—Ä—ã (–¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ö–æ—Å—Ç–∞ –∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)

---

## üîå USB Handshake –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–∞—è)

```
1. –ü–æ–∏—Å–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (0xCAFE:0x4001)
   ‚Üì
2. SetConfig(1) + Claim IF#2
   ‚Üì
3. SET_INTERFACE (0x0B/0x01, wIndex=2)  ‚Üê primary method
   Fallback: Vendor SET_ALT (0x31/0x40 –∏–ª–∏ 0x31/0x41)
   ‚Üì
4. EP0 GET_STATUS poll (5‚Äì10 –º—Å, –¥–æ 200 –º—Å)
   –ò—â–µ–º: alt1=1 –ò out_armed=1 (–∏–∑ STAT v1)
   ‚Üì
5. CLEAR_HALT –Ω–∞ 0x03/0x83
   ‚Üì
6. –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥ (SET_PROFILE, START_STREAM)
   ‚Üì
7. –ü—Ä–∏–µ–º A/B –ø–∞—Ä —Å—Ç–µ—Ä–µ–æ-–¥–∞–Ω–Ω—ã—Ö
```

**EIO Recovery Loop**:
```
–ï—Å–ª–∏ Bulk OUT ‚Üí EIO (errno 5):
  ‚îú‚îÄ GET_STATUS ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å alt1/out_armed
  ‚îú‚îÄ CLEAR_HALT ‚Üí –æ—á–∏—Å—Ç–∏—Ç—å HALT
  ‚îú‚îÄ _wait_ready(0.2s) ‚Üí –ø–µ—Ä–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å
  ‚îî‚îÄ Retry OUT (–¥–æ 3 –ø–æ–ø—ã—Ç–æ–∫)
```

---

## üìä GUI –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –õ–µ–≥–µ–Ω–¥–∞ (–≤–µ—Ä—Ö–Ω—è—è –ø–æ–ª–æ—Å–∞)
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ BUF=680 FREQ=200Hz | [200 Hz] | [‚Üª] | [‚ö°] | [ü©∫] ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
 ‚Üë                      ‚Üë        ‚Üë     ‚Üë      ‚Üë
 –ë—É—Ñ–µ—Ä,                 Freq   Reconnect Power Diag
 —á–∞—Å—Ç–æ—Ç–∞                –≤—ã–±–æ—Ä  button   cycle button
```

### –ì—Ä–∞—Ñ–∏–∫–∏
- **–í–µ—Ä—Ö–Ω–∏–π**: ADC0 (–∑–µ–ª—ë–Ω—ã–π, —Å–∏–º–≤–æ–ª—ã-—Ç–æ—á–∫–∏)
- **–ù–∏–∂–Ω–∏–π**: ADC1 (—Å–∏–Ω–∏–π, —Å–∏–º–≤–æ–ª—ã-—Ç–æ—á–∫–∏)
- **X-–æ—Å—å**: –ò–Ω–¥–µ–∫—Å—ã —Å–µ–º–ø–ª–æ–≤ (—Ü–µ–ª—ã–µ —á–∏—Å–ª–∞)
- **Y-–æ—Å—å**: –ê–º–ø–ª–∏—Ç—É–¥–∞, —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω (‚àí32768 ... +32767)

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
| –ö–Ω–æ–ø–∫–∞ | –î–µ–π—Å—Ç–≤–∏–µ |
|--------|----------|
| ‚Üª | –†—É—á–Ω–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É |
| ‚ö° | –ü–µ—Ä–µ–∑–∞–ø–∏—Ç –ø–∏—Ç–∞–Ω–∏—è USB-–ø–æ—Ä—Ç–∞ (uhubctl) |
| ü©∫ | –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: GET_STATUS, SOFT_RESET, –ø—Ä–æ–≤–µ—Ä–∫–∞ alt/out_armed |
| [Freq] | –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã (200 –ì—Ü ‚Üî 300 –ì—Ü) |

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –°—Ç–∞—Ä—Ç

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
pip install pyusb pyqtgraph PyQt5 numpy
```

### –ó–∞–ø—É—Å–∫ GUI
```bash
cd /home/techaid/Documents
python3 BMI30.200.py
```

### –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥ –∫–æ–Ω—Å–æ–ª–∏
```
[init] ‚Üê detected device 0xCAFE:0x4001
[init] ‚Üí IF#2 claimed, alt=0
[wait] ‚Üê SET_INTERFACE alt=1 set
[wait] ‚Üí polling for alt1/out_armed...
[wait] ‚Üê alt1=1, out_armed=1 (ready)
[clear] ‚Üí HALT cleared on 0x03/0x83
[tx] cmd=0x14 n=3  ‚Üê SET_PROFILE OK
[tx] cmd=0x20 n=1  ‚Üê START_STREAM OK
[stream] ‚Üê A[seq=1] (680B), B[seq=1] (680B), pairs=1, FPS=200
```

---

## üìÅ –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ –§–∞–π–ª—ã

| –§–∞–π–ª | –°—Ç—Ä–æ–∫–∏ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------|--------|-----------|
| `BMI30.200.py` | 792‚Äì815 | STAT v1 parser (alt1/out_armed —Ñ–ª–∞–≥–∏) |
| `usb_vendor/usb_stream.py` | 330‚Äì350 | EP0 GET_STATUS (bmRequestType=0xC0) |
| `usb_vendor/usb_stream.py` | 350‚Äì363 | _parse_stat_ready (STAT v1 offsets) |
| `usb_vendor/usb_stream.py` | 364‚Äì394 | _wait_ready (—É–ø—Ä–æ—â—ë–Ω–Ω—ã–π, —á–∏—Å—Ç—ã–π polling) |
| `usb_vendor/usb_stream.py` | 620‚Äì705 | _ensure_alt (SET_INTERFACE primary) |
| `usb_vendor/usb_stream.py` | 710‚Äì745 | send_cmd (EIO handling —Å GET_STATUS/CLEAR_HALT) |

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ï—Å–ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: `lsusb | grep cafe:4001`
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∞—Ö: `sudo python3 BMI30.200.py` –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ udev-–ø—Ä–∞–≤–∏–ª–æ

### –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ
1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **ü©∫** (–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ firmware —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç STAT v1 –∏ alt=1

### –ï—Å–ª–∏ —á–∞—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è EIO
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ USB –∫–∞–±–µ–ª—å –∏ –ø–æ—Ä—Ç
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `_clear_halt_eps()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ alt=1
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Ç—å –ø–∏—Ç–∞–Ω–∏–µ –∫–Ω–æ–ø–∫–æ–π **‚ö°**

---

## üìö –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –°—Å—ã–ª–∫–∏

- **STAT v1 –§–æ—Ä–º–∞—Ç**: 64-–±–∞–π—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å —Ñ–ª–∞–≥–∞–º–∏ alt1/out_armed, –∏–Ω–¥–µ–∫—Å–æ–º –ø–∞—Ä—ã, —Å—á—ë—Ç—á–∏–∫–∞–º–∏
- **USB IF#2**: Bulk endpoints OUT 0x03, IN 0x83 (Vendor Bulk —Å—Ç–µ—Ä–µ–æ)
- **A/B –ü–∞–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Å—á—ë—Ç—á–∏–∫–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, tolerance ¬±5 —Ñ—Ä–µ–π–º–æ–≤
- **–ü—Ä–æ—Ñ–∏–ª–∏**: 0=DIAG, 1=FULL@200Hz, 2=FULL@300Hz

---

## ‚ú® –î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–µ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

‚úÖ **GUI**
- –ñ–∏–≤–∞—è –æ—Å—Ü–∏–ª–ª–æ–≥—Ä–∞–º–º–∞ —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ —Å–µ–º–ø–ª–æ–≤ –Ω–∞ X-–æ—Å–∏
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ BUF –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø–æ—Ç–æ–∫–∞
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ ADC0 –∏ ADC1
- –ö–Ω–æ–ø–∫–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

‚úÖ **USB Transport**
- SET_INTERFACE –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π alt-setter
- –ù–∞–¥—ë–∂–Ω—ã–π handshake —Å polling alt1/out_armed
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ EIO
- STAT v1 –ø–∞—Ä—Å–∏–Ω–≥ –ø–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏

‚úÖ **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
- –î–æ 200 FPS –ø—Ä–∏ profile=1, full=True
- –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è A/B –ø–∞—Ä –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –¥–∞–Ω–Ω—ã—Ö

---

**–°—Ç–∞—Ç—É—Å**: üéâ –ì–û–¢–û–í–û –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏ —á–∏—Å—Ç—ã–µ, –ª–æ–≥–∏—á–µ—Å–∫–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ firmware STAT v1.

–ü–æ–¥–∫–ª—é—á–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ 0xCAFE:0x4001 –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ `python3 BMI30.200.py`!
